<!DOCTYPE html>
<html>
<head>
<title>Programming in MATLAB</title>
<meta charset="utf-8">
<style>
@import url(https://fonts.googleapis.com/css?family=Open+Sans);
@import url(https//fonts.googleapis.com/css?family=Montserrat);
@import url(https://fonts.googleapis.com/css?family=Roboto:400,700,400italic);
@import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);
@import url(https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700,400italic);

body { font-family: 'Open Sans'; }
h1, h2, h3 {
	font-family: 'Open Sans';
	font-weight: normal;
}
.remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
</style>
</head>
<body>
<textarea id="source">

class: center, middle

# Programming in MATLAB
## Gerard Capes
### Research IT, University of Manchester
### https://gcapes.github.io/matlab-programming/
(You will need to "Load unsafe scripts")
---

## Agenda

1. Recap of online lessons
	- Number types and automatic casting
	- Scripts and Functions
3. Worked examples of common tasks
	- Loading data into MATLAB
	- Processing data in the workspace
		- Extract sub-sets of data, basic statistics,
		filtering bad data points
	- Basic plotting
3. How to write your own scripts and functions
4. Debugging demo
	- break points
	- evaluate small sections at a time
	- version control revert
4. Good programming practice
	- Comments
	- Assertions
	- Version control
5. Tips and common problems

---
class: center,  middle

## Recap
---
## MATLAB GUI
- Command window
	- Type commands for immediate execution
	- Variables created persist in workspace after commands finish
- Workspace
	- Contains variables stored in memory
- Editor
	- Write commands for execution later on
	- Save files with `.m` extension and run using the name of the file e.g.
```
>> myscript % runs the file called myscript.m
```
---

## Number types

- Computers represent numbers using [binary numbers](https://en.wikipedia.org/wiki/Binary_number),
  most frequently using floating point numbers
- Floating point numbers are an approximation to real numbers, and
  not all numbers can be represented exactly (c.f. 1/3 in decimal)
- [What every scientist should know about floating point arithmetic
  ](https://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html)
- Default data type in MATLAB is double (i.e. double precision:
  approx 16 significant decimal digits)
- Be aware of the maximum and minimum values that can be stored by a given
  number type 
  ```
  intmax('uint16')   % max value for an unsigned 16-bit integer
  realmin('single')  % minimum value for single precision floating point
  eps                % floating point relative accuracy
  ```
- MATLAB performs automatic type casting (without warning)
```
intmax('uint8')    % max value that uint8 can store = 2^8 -1
a = uint8(300)     % a = 255 (300 truncated to max value) 
b = 2.3 + 1e6 + a  % b = 255 (b is uint8)
```
---
## Variables

- Used to store values
- Created implicitly
```
a = 23   % Assign value 23 to a variable, a.
             % If 'a' doesn't already exist it will be created.
             % If 'a' already exists, it will be overwritten.
class(a) % Returns class of variable 'a'.
```
- Numeric variables are of `class` double by default
	- must explicitly create other numeric types if required
- MATLAB doesn't prevent you from using built-in MATLAB keywords
	- Can 'overwrite' MATLAB function names very easily
```
intmax('uint8')          % Returns max value of 8-bit integer
intmax = intmax('uint8') % Create variable 'intmax'
% This has now blocked access to the 'intmax' function
intmax('uint8')          % Returns an error
```
- Names must start with a letter. Chose descriptive names which don't mask
built-in functions
- Demo
---
## Scripts and functions

- Scripts are like automating the command window
	- Have access to variables in the workspace
	- Variables persist after script execution
- Functions have their own scope
	- Cannot directly access variables in the workspace or other functions
	- Can only use variables from the workspace if passed in as arguments
	- Variables created in a function do not persist after execution
	(unless returned as output arguments)
- Run a script or function using the name of the file in the command window
(or another script/function)
- A `.m` file can only be run if it is on the MATLAB `path` (list of directories to search)
- Both scripts and functions are very helpful in terms of reproducibility
- Demo
---
class: center,  middle
## Worked examples
### (Writing scripts and functions)
---
## Import CO2 data from text files

- Load a file using the GUI to select:
	- starting row
	- specific columns
	- data format
	- variable names
	- column delimiters
	- multiple delimiters
- Tips:
	- import window remains open
	- save the code as a script for future use
	- use `datetime` format for time series
- Plot graph
	- line of best fit (tools > basic fitting) doesn't work with `datetime` format
	- plot doesn't update if data is modified
---
## Process data
- Remove bad data values using:
	- command line
	- script
	- function
---
## Other data structures
- Everything in MATLAB is a matrix
	- strings, scalar variables, vectors, matrices
- These can be grouped using data structures
	- Cell arrays for flexible data storage of multiple data types
	- Structures for named fields containing values
- Structure field names can be dynamically assigned using strings
---
- Average data for comparison with other data sets
	- assertions
- List files in a directory with `dir` and load data in a loop
---
class: center,  middle
## Debugging
---
## Approaches
- Know what outcome you are expecting
- Evaluate small sections of code at a time (one function, one line, one command)
- Using intermediate variables in loops can sometimes help debugging
- Explain the problem to someone else:
	- Write down what you're trying to do
	- What are the steps to reproduce the problem?
	- Very often the process of explaining the problem leads you to the error
---
## Tips and common problems
- Load data window remains open after loading data (looks like nothing has happened if maximised)
- Close MATLAB - no prompt to save workspace variables; only modified scripts
- Variables are implicitly declared so easy to accidentally overwrite
</textarea>
<script src="https://gnab.github.io/remark/downloads/remark-latest.min.js">
</script>
<script>
var slideshow = remark.create({highlightLanguage: 'matlab'});
</script>
</body>
</html>
